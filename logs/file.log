2025-02-22 18:40:08.139 | INFO     | main:root:10 - 这是由logger产生的日志
2025-02-22 18:40:08.382 | INFO     | main:root:10 - 这是由logger产生的日志
2025-02-22 18:50:12.398 | INFO     | main:root:14 - 这是由logger产生的日志
2025-02-22 18:50:12.598 | INFO     | main:root:14 - 这是由logger产生的日志
2025-02-22 18:54:47.970 | SUCCESS  | main:root:16 - 这是success的日志！
2025-02-25 16:15:03.597 | ERROR    | hooks.middlewares:log_middleware:16 - 日志记录发生异常
Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000002292E1FA340>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2375942548560, name='Task-8'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 148, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000002292E1FA3E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(parent_pid=10716, pipe_handle=524)
                                      │           └ <function spawn_main at 0x000002292DCD5080>
                                      └ <function spawn_main at 0x000002292DCD5080>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 360
               │     └ 3
               └ <function _main at 0x000002292DCD5120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 360
           │    └ <function BaseProcess._bootstrap at 0x000002292D862340>
           └ <SpawnProcess name='SpawnProcess-1' parent=10716 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002292D8618A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=10716 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002292E18A120>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=10716 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=10716 started>
    │    └ <function subprocess_started at 0x000002292E0E1E40>
    └ <SpawnProcess name='SpawnProcess-1' parent=10716 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=556, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002292E18A270>>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=556, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002292E0E0E00>
           │       │   └ <uvicorn.server.Server object at 0x000002292E18A270>
           │       └ <function run at 0x000002292DE16FC0>
           └ <module 'asyncio' from 'C:\\Users\\70756\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002292E20C820>
           │      └ <function Runner.run at 0x000002292DE84CC0>
           └ <asyncio.runners.Runner object at 0x000002292E18AF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-p...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002292DE7E700>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002292E18AF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 707, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002292DE7E660>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 678, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002292DE844A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 2033, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002292DE02020>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000022931531400>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022931...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000022931530EC0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000022931531400>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022931...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022931...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000022931531D30>
          └ <fastapi.applications.FastAPI object at 0x0000022931530EC0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002293159F560>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000022931531BE0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000022931531D30>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 179, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002293159FB00>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000022931569950>
                     │    └ <function log_middleware at 0x0000022930559E40>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000022931531BE0>

> File "D:\project\python\microservice\user_api\hooks\middlewares.py", line 10, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000022931569950>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002293159FB00>

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 154, in call_next
    raise app_exc
          └ InvalidSubjectError('Subject must be a string')
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000229315A05E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229315A0680>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000022931531A90>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000022931531BE0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000229315A05E0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229315A0680>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000022931569F90>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002293152CF50>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000022931531A90>
          └ <function wrap_app_handling_exceptions at 0x000002293009D440>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000229315A0AE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229315A0680>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002293152CF50>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000229315A0AE0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229315A0680>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002293152CF50>>
          └ <fastapi.routing.APIRouter object at 0x000002293152CF50>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000229315A0AE0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229315A0680>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002293009EC00>
          └ APIRoute(path='/user/access/token', name='access_token_view', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000229315A0AE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229315A0680>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000022931548220>
          └ APIRoute(path='/user/access/token', name='access_token_view', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000229315A0AE0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229315A0680>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000022930FBFA80>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000229315A0B80>
          └ <function wrap_app_handling_exceptions at 0x000002293009D440>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000229315A0CC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229315A0680>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000229315A0B80>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000022930FBFA80>
                     └ <function get_request_handler.<locals>.app at 0x0000022931548180>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x00000229300BEAC0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\dependencies\utils.py", line 640, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
                   │                 │       │             └ {'auth': HTTPAuthorizationCredentials(scheme='Bearer', credentials='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOjE4OTMzNTgx...
                   │                 │       └ SolvedDependency(values={'auth': HTTPAuthorizationCredentials(scheme='Bearer', credentials='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXV...
                   │                 └ <bound method AuthHandler.auth_access_dependency of <utils.auth.AuthHandler object at 0x0000022931530590>>
                   └ <function run_in_threadpool at 0x000002292EF987C0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\concurrency.py", line 37, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
                 │     │         │        └ functools.partial(<bound method AuthHandler.auth_access_dependency of <utils.auth.AuthHandler object at 0x0000022931530590>>,...
                 │     │         └ <function run_sync at 0x000002292E1413A0>
                 │     └ <module 'anyio.to_thread' from 'C:\\Users\\70756\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\anyio\\to_...
                 └ <module 'anyio' from 'C:\\Users\\70756\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\anyio\\__init__.py'>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
                 └ <function get_async_backend at 0x000002292E140AE0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=InvalidSubjectError('Subject must be a string')>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<bound method AuthHandler.auth_access_dependency of <utils.auth.AuthHandler object at 0x0000022931530590>>,...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002293155FC00>

  File "D:\project\python\microservice\user_api\utils\auth.py", line 84, in auth_access_dependency
    return self.decode_access_token(auth.credentials)
           │    │                   │    └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOjE4OTMzNTgxNTczMzAxMjA3MDQsInN1YiI6MSwiZXhwIjoxNzQwNDcxNDExfQ.TNXfx1oz1oeiEPuS...
           │    │                   └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOjE4OTMzNTgxNTczMzAxM...
           │    └ <function AuthHandler.decode_access_token at 0x0000022931524720>
           └ <utils.auth.AuthHandler object at 0x0000022931530590>

  File "D:\project\python\microservice\user_api\utils\auth.py", line 57, in decode_access_token
    payload = jwt.decode(token, self.secret, algorithms=['HS256'])
              │   │      │      │    └ 'qweqfsfsafaf'
              │   │      │      └ <utils.auth.AuthHandler object at 0x0000022931530590>
              │   │      └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOjE4OTMzNTgxNTczMzAxMjA3MDQsInN1YiI6MSwiZXhwIjoxNzQwNDcxNDExfQ.TNXfx1oz1oeiEPuS...
              │   └ <bound method PyJWT.decode of <jwt.api_jwt.PyJWT object at 0x00000229313970E0>>
              └ <module 'jwt' from 'C:\\Users\\70756\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\jwt\\__init__.py'>

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\jwt\api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              │    └ <function PyJWT.decode_complete at 0x000002293150FEC0>
              └ <jwt.api_jwt.PyJWT object at 0x00000229313970E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\jwt\api_jwt.py", line 167, in decode_complete
    self._validate_claims(
    │    └ <function PyJWT._validate_claims at 0x00000229315240E0>
    └ <jwt.api_jwt.PyJWT object at 0x00000229313970E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\jwt\api_jwt.py", line 273, in _validate_claims
    self._validate_sub(payload, subject)
    │    │             │        └ None
    │    │             └ {'iss': 1893358157330120704, 'sub': 1, 'exp': 1740471411}
    │    └ <function PyJWT._validate_sub at 0x0000022931524220>
    └ <jwt.api_jwt.PyJWT object at 0x00000229313970E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\jwt\api_jwt.py", line 300, in _validate_sub
    raise InvalidSubjectError("Subject must be a string")
          └ <class 'jwt.exceptions.InvalidSubjectError'>

jwt.exceptions.InvalidSubjectError: Subject must be a string
2025-02-26 18:44:17.304 | ERROR    | hooks.middlewares:log_middleware:16 - 日志记录发生异常
Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001B7713EA340>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=1887451478368, name='Task-4'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 148, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001B7713EA3E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(parent_pid=22624, pipe_handle=556)
                                      │           └ <function spawn_main at 0x000001B770EC5080>
                                      └ <function spawn_main at 0x000001B770EC5080>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x000001B770EC5120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x000001B770A32340>
           └ <SpawnProcess name='SpawnProcess-1' parent=22624 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001B770A318A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=22624 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001B77137A120>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=22624 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=22624 started>
    │    └ <function subprocess_started at 0x000001B7712D1E40>
    └ <SpawnProcess name='SpawnProcess-1' parent=22624 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=560, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001B77137A270>>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=560, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001B7712D0E00>
           │       │   └ <uvicorn.server.Server object at 0x000001B77137A270>
           │       └ <function run at 0x000001B771006FC0>
           └ <module 'asyncio' from 'C:\\Users\\70756\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001B7713FC820>
           │      └ <function Runner.run at 0x000001B771074CC0>
           └ <asyncio.runners.Runner object at 0x000001B77137AF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-p...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001B77106E700>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001B77137AF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 707, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001B77106E660>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 678, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001B7710744A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 2033, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001B770FF2020>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001B774EA17F0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B774...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001B774EA12B0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001B774EA17F0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B774...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B774...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001B774EA2120>
          └ <fastapi.applications.FastAPI object at 0x000001B774EA12B0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001B774F084A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001B774EA1FD0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001B774EA2120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 179, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001B774F08540>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001B774EA3B60>
                     │    └ <function log_middleware at 0x000001B773749EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001B774EA1FD0>

> File "D:\project\python\microservice\user_api\hooks\middlewares.py", line 10, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001B774EA3B60>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001B774F08540>

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 154, in call_next
    raise app_exc
          └ AttributeError("module 'services.protos.address_pb2' has no attribute 'GetAddressById'")
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001B774F082C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B774F08040>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001B774EA1E80>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001B774EA1FD0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001B774F082C0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B774F08040>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001B774F3D2B0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001B774E3DA70>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001B774EA1E80>
          └ <function wrap_app_handling_exceptions at 0x000001B7722B94E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B774F80180>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B774F08040>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001B774E3DA70>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B774F80180>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B774F08040>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001B774E3DA70>>
          └ <fastapi.routing.APIRouter object at 0x000001B774E3DA70>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B774F80180>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B774F08040>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001B7722BACA0>
          └ APIRoute(path='/address/detail/{id}', name='get_address_by_id', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B774F80180>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B774F08040>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001B774ECEA20>
          └ APIRoute(path='/address/detail/{id}', name='get_address_by_id', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B774F80180>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B774F08040>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001B774EF7D90>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001B774F80220>
          └ <function wrap_app_handling_exceptions at 0x000001B7722B94E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B774F80360>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B774F08040>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001B774F80220>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001B774EF7D90>
                     └ <function get_request_handler.<locals>.app at 0x000001B774ECEB60>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001B7722B8AE0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_id': 1893358157330120704, 'id': '9022f36ce46540b5a1e5d85da0dcb215'}
                 │         └ <function get_address_by_id at 0x000001B774ECFC40>
                 └ Dependant(path_params=[ModelField(field_info=Path(PydanticUndefined), name='id', mode='validation')], query_params=[], header...

  File "D:\project\python\microservice\user_api\routers\address.py", line 48, in get_address_by_id
    address = await address_service_client.get_address_by_id(user_id=user_id, id=id)
                    │                      │                         │           └ '9022f36ce46540b5a1e5d85da0dcb215'
                    │                      │                         └ 1893358157330120704
                    │                      └ <function AddressServiceClient.get_address_by_id at 0x000001B774ECD8A0>
                    └ <services.address.AddressServiceClient object at 0x000001B77347B620>

  File "D:\project\python\microservice\user_api\services\decorators.py", line 11, in wrapper
    result = await func(*args, **kwargs)
                   │     │       └ {'user_id': 1893358157330120704, 'id': '9022f36ce46540b5a1e5d85da0dcb215'}
                   │     └ (<services.address.AddressServiceClient object at 0x000001B77347B620>,)
                   └ <function AddressServiceClient.get_address_by_id at 0x000001B774ECD800>

  File "D:\project\python\microservice\user_api\services\address.py", line 70, in get_address_by_id
    request = address_pb2.GetAddressById(id=id, user_id=user_id)
              │                             │           └ 1893358157330120704
              │                             └ '9022f36ce46540b5a1e5d85da0dcb215'
              └ <module 'services.protos.address_pb2' from 'D:\\project\\python\\microservice\\user_api\\services\\protos\\address_pb2.py'>

AttributeError: module 'services.protos.address_pb2' has no attribute 'GetAddressById'
2025-02-26 18:56:36.489 | ERROR    | hooks.middlewares:log_middleware:16 - 日志记录发生异常
Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021FDD6DA340>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2335943162208, name='Task-7'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 148, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021FDD6DA3E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(parent_pid=24352, pipe_handle=784)
                                      │           └ <function spawn_main at 0x0000021FDD1B5080>
                                      └ <function spawn_main at 0x0000021FDD1B5080>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 328
               │     └ 3
               └ <function _main at 0x0000021FDD1B5120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 328
           │    └ <function BaseProcess._bootstrap at 0x0000021FDCD22340>
           └ <SpawnProcess name='SpawnProcess-11' parent=24352 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021FDCD218A0>
    └ <SpawnProcess name='SpawnProcess-11' parent=24352 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021FDD66A120>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=24352 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=24352 started>
    │    └ <function subprocess_started at 0x0000021FDD5C1E40>
    └ <SpawnProcess name='SpawnProcess-11' parent=24352 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=516, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021FDD66A270>>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=516, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000021FDD5C0E00>
           │       │   └ <uvicorn.server.Server object at 0x0000021FDD66A270>
           │       └ <function run at 0x0000021FDD2F6FC0>
           └ <module 'asyncio' from 'C:\\Users\\70756\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021FDD6EC820>
           │      └ <function Runner.run at 0x0000021FDD364CC0>
           └ <asyncio.runners.Runner object at 0x0000021FDD66AF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-p...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021FDD35E700>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021FDD66AF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 707, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021FDD35E660>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 678, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021FDD3644A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 2033, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021FDD2E2020>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021FE11A57F0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021FE1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021FDF76B620>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021FE11A57F0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021FE1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021FE1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021FE11A6120>
          └ <fastapi.applications.FastAPI object at 0x0000021FDF76B620>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021FE1290CC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000021FE11A5FD0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021FE11A6120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 179, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021FE1290F40>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021FE126CB90>
                     │    └ <function log_middleware at 0x0000021FDFA39EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000021FE11A5FD0>

> File "D:\project\python\microservice\user_api\hooks\middlewares.py", line 10, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021FE126CB90>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021FE1290F40>

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 154, in call_next
    raise app_exc
          └ AttributeError("module 'services.protos.address_pb2' has no attribute 'GetAddressList'")
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021FE1290A40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021FE1290EA0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021FE11A5E80>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000021FE11A5FD0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021FE1290A40>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021FE1290EA0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000021FE1142520>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000021FE1141A70>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021FE11A5E80>
          └ <function wrap_app_handling_exceptions at 0x0000021FDF5794E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021FE1290FE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021FE1290EA0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000021FE1141A70>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021FE1290FE0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021FE1290EA0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000021FE1141A70>>
          └ <fastapi.routing.APIRouter object at 0x0000021FE1141A70>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021FE1290FE0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021FE1290EA0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000021FDF57ACA0>
          └ APIRoute(path='/address/list', name='get_address_list', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021FE1290FE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021FE1290EA0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000021FE120D6C0>
          └ APIRoute(path='/address/list', name='get_address_list', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021FE1290FE0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021FE1290EA0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000021FE1278EF0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000021FE1291080>
          └ <function wrap_app_handling_exceptions at 0x0000021FDF5794E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021FE12911C0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021FE1290EA0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000021FE1291080>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000021FE1278EF0>
                     └ <function get_request_handler.<locals>.app at 0x0000021FE120D940>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000021FDF578AE0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_id': 1893358157330120704, 'page': 1, 'size': 20}
                 │         └ <function get_address_list at 0x0000021FE119F100>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(1), name='page', mode='validation'), ModelField(field_inf...

  File "D:\project\python\microservice\user_api\routers\address.py", line 54, in get_address_list
    addresses = await address_service_client.get_address_list(page=page, size=size, user_id=user_id)
                      │                      │                     │          │             └ 1893358157330120704
                      │                      │                     │          └ 20
                      │                      │                     └ 1
                      │                      └ <function AddressServiceClient.get_address_list at 0x0000021FE11CD9E0>
                      └ <services.address.AddressServiceClient object at 0x0000021FE11A5160>

  File "D:\project\python\microservice\user_api\services\decorators.py", line 11, in wrapper
    result = await func(*args, **kwargs)
                   │     │       └ {'page': 1, 'size': 20, 'user_id': 1893358157330120704}
                   │     └ (<services.address.AddressServiceClient object at 0x0000021FE11A5160>,)
                   └ <function AddressServiceClient.get_address_list at 0x0000021FE11CD940>

  File "D:\project\python\microservice\user_api\services\address.py", line 77, in get_address_list
    request = address_pb2.GetAddressList(user_id=user_id, page=page, size=size)
              │                                  │             │          └ 20
              │                                  │             └ 1
              │                                  └ 1893358157330120704
              └ <module 'services.protos.address_pb2' from 'D:\\project\\python\\microservice\\user_api\\services\\protos\\address_pb2.py'>

AttributeError: module 'services.protos.address_pb2' has no attribute 'GetAddressList'
2025-02-26 18:57:10.392 | ERROR    | hooks.middlewares:log_middleware:16 - 日志记录发生异常
Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001E58E13A340>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2085503695376, name='Task-4'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 148, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001E58E13A3E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(parent_pid=11464, pipe_handle=528)
                                      │           └ <function spawn_main at 0x000001E58DC15080>
                                      └ <function spawn_main at 0x000001E58DC15080>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000001E58DC15120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000001E58D782340>
           └ <SpawnProcess name='SpawnProcess-1' parent=11464 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001E58D7818A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=11464 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001E58E0CA120>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11464 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11464 started>
    │    └ <function subprocess_started at 0x000001E58E021E40>
    └ <SpawnProcess name='SpawnProcess-1' parent=11464 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=552, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001E58E0CA270>>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=552, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001E58E020E00>
           │       │   └ <uvicorn.server.Server object at 0x000001E58E0CA270>
           │       └ <function run at 0x000001E58DD56FC0>
           └ <module 'asyncio' from 'C:\\Users\\70756\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001E58E14C820>
           │      └ <function Runner.run at 0x000001E58DDC4CC0>
           └ <asyncio.runners.Runner object at 0x000001E58E0CAF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-p...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001E58DDBE700>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001E58E0CAF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 707, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001E58DDBE660>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 678, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E58DDC44A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 2033, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E58DD42020>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001E591BF57F0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E591...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001E5901CB620>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001E591BF57F0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E591...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E591...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001E591BF6120>
          └ <fastapi.applications.FastAPI object at 0x000001E5901CB620>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001E591C95440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E591BF5FD0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001E591BF6120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 179, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001E591C954E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001E591BF7B60>
                     │    └ <function log_middleware at 0x000001E590499EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E591BF5FD0>

> File "D:\project\python\microservice\user_api\hooks\middlewares.py", line 10, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001E591BF7B60>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001E591C954E0>

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 154, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E591C5D8A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E591C958A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E591BF5E80>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E591BF5FD0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E591C5D8A0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E591C958A0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001E591CA92B0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001E591B91A70>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E591BF5E80>
          └ <function wrap_app_handling_exceptions at 0x000001E58F0094E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E591CDC680>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E591C958A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001E591B91A70>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E591CDC680>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E591C958A0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001E591B91A70>>
          └ <fastapi.routing.APIRouter object at 0x000001E591B91A70>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E591CDC680>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E591C958A0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001E58F00ACA0>
          └ APIRoute(path='/address/list', name='get_address_list', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E591CDC680>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E591C958A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001E591C5D580>
          └ APIRoute(path='/address/list', name='get_address_list', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E591CDC680>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E591C958A0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001E591C4D310>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001E591CDC720>
          └ <function wrap_app_handling_exceptions at 0x000001E58F0094E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E591CDC860>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E591C958A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001E591CDC720>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001E591C4D310>
                     └ <function get_request_handler.<locals>.app at 0x000001E591C5D760>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001E58F009120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'addresses'), 'msg': 'Field required', 'input': [id: "370207f025ea4e628caf050839b60631"
realname: "lilili"
mobile: "1999999999"
region: "广东广州"
detail: "weqeq"
, id: "9022f36ce46540b5a1e5d85da0dcb215"
realname: "hahaha"
mobile: "1999999999"
region: "广东广州"
detail: "weqeq"
]}

2025-02-26 18:59:17.527 | ERROR    | hooks.middlewares:log_middleware:16 - 日志记录发生异常
Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001E593C2A340>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2085599115616, name='Task-7'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 148, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001E593C2A3E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(parent_pid=11464, pipe_handle=528)
                                      │           └ <function spawn_main at 0x000001E593705080>
                                      └ <function spawn_main at 0x000001E593705080>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 384
               │     └ 3
               └ <function _main at 0x000001E593705120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 384
           │    └ <function BaseProcess._bootstrap at 0x000001E593272340>
           └ <SpawnProcess name='SpawnProcess-2' parent=11464 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001E5932718A0>
    └ <SpawnProcess name='SpawnProcess-2' parent=11464 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001E593BBA120>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=11464 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=11464 started>
    │    └ <function subprocess_started at 0x000001E593B11E40>
    └ <SpawnProcess name='SpawnProcess-2' parent=11464 started>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001E593BBA270>>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001E593B10E00>
           │       │   └ <uvicorn.server.Server object at 0x000001E593BBA270>
           │       └ <function run at 0x000001E593846FC0>
           └ <module 'asyncio' from 'C:\\Users\\70756\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001E593C3C820>
           │      └ <function Runner.run at 0x000001E5938B4CC0>
           └ <asyncio.runners.Runner object at 0x000001E593BBAF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-p...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001E5938AE700>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001E593BBAF90>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 707, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001E5938AE660>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 678, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E5938B44A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 2033, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E593832020>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001E5976F57F0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E597...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001E595CBB620>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001E5976F57F0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E597...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E597...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001E5976F6120>
          └ <fastapi.applications.FastAPI object at 0x000001E595CBB620>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001E5977954E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E5976F5FD0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001E5976F6120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 179, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001E5977DD3A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001E5977B4B90>
                     │    └ <function log_middleware at 0x000001E595F89EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E5976F5FD0>

> File "D:\project\python\microservice\user_api\hooks\middlewares.py", line 10, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001E5977B4B90>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001E5977DD3A0>

  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 154, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E5977DCEA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E5977DCF40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E5976F5E80>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E5976F5FD0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E5977DCEA0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E5977DCF40>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001E597692520>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001E597691A70>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E5976F5E80>
          └ <function wrap_app_handling_exceptions at 0x000001E595AC94E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E5977DD440>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E5977DCF40>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001E597691A70>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E5977DD440>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E5977DCF40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001E597691A70>>
          └ <fastapi.routing.APIRouter object at 0x000001E597691A70>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E5977DD440>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E5977DCF40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001E595ACACA0>
          └ APIRoute(path='/address/list', name='get_address_list', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E5977DD440>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E5977DCF40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001E59775D6C0>
          └ APIRoute(path='/address/list', name='get_address_list', methods=['GET'])
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E5977DD440>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E5977DCF40>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001E5977C4EF0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001E5977DD080>
          └ <function wrap_app_handling_exceptions at 0x000001E595AC94E0>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E5977DD1C0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E5977DCF40>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001E5977DD080>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001E5977C4EF0>
                     └ <function get_request_handler.<locals>.app at 0x000001E59775D940>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001E595AC9120>
  File "C:\Users\70756\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'addresses'), 'msg': 'Field required', 'input': [id: "370207f025ea4e628caf050839b60631"
realname: "lilili"
mobile: "1999999999"
region: "广东广州"
detail: "weqeq"
, id: "9022f36ce46540b5a1e5d85da0dcb215"
realname: "hahaha"
mobile: "1999999999"
region: "广东广州"
detail: "weqeq"
]}

