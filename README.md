# ç§’æ€å¾®æœåŠ¡ç³»ç»Ÿ - Seckill Microservice System

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
![GitHub stars](https://img.shields.io/github/stars/yourusername/projectname?style=social)

åŸºäºå¾®æœåŠ¡æ¶æ„çš„é«˜å¹¶å‘ç§’æ€ç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç»ˆç«¯è®¿é—®ä¸å®æ—¶ç›‘æ§

## ğŸ“– é¡¹ç›®æ¦‚è§ˆ

### ç³»ç»Ÿæ¶æ„
![Architecture Diagram](docs/architecture.png) <!--  -->

### æ ¸å¿ƒç‰¹æ€§
- **å¤šç»ˆç«¯æ”¯æŒ**: Uniappå®ç°ä¸‰ç«¯ï¼ˆAndroid/iOS/Webï¼‰ç»Ÿä¸€è®¿é—®
- **é«˜å¹¶å‘å¤„ç†**: Redisç¼“å­˜ + Kafkaå¼‚æ­¥é˜Ÿåˆ— + æœåŠ¡è§£è€¦
- **å®‰å…¨æœºåˆ¶**: JWTé‰´æƒ + Nginxåå‘ä»£ç† + é˜¿é‡Œäº‘å®‰å…¨æœåŠ¡
- **å¯è§‚æµ‹æ€§**: Prometheusç›‘æ§ + Grafanaå¯è§†åŒ–é¢æ¿
- **äº‘åŸç”Ÿæ”¯æŒ**: ConsulæœåŠ¡å‘ç° + DockeråŒ–éƒ¨ç½²ï¼ˆå¾…å®ç°ï¼‰

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| ç»„ä»¶         | æŠ€æœ¯é€‰å‹                                                     |
| ------------ | ------------------------------------------------------------ |
| **å‰ç«¯**     | Uniapp + Vue3 + Element Plus                                 |
| **ç½‘å…³å±‚**   | Nginx (SSL Termination + Load Balancing)                     |
| **ä¸šåŠ¡æœåŠ¡** | FastAPI (ASGI) +Django (Admin)                               |
| **æ•°æ®å±‚**   | MySQL 8.0 + Redis 6.x + Kafka 3.x                            |
| **åŸºç¡€è®¾æ–½** | Consul (æœåŠ¡å‘ç°) + Prometheus/Grafana (ç›‘æ§) + é˜¿é‡Œäº‘ç”Ÿæ€(OSS/SMS/æ”¯ä»˜) |

## ğŸ§© æœåŠ¡æ¨¡å—

### æ ¸å¿ƒæœåŠ¡
| æœåŠ¡åç§°           | åŠŸèƒ½æè¿°            | å…³é”®æŠ€æœ¯                        |
| ------------------ | ------------------- | ------------------------------- |
| user_api           | ç”¨æˆ·è®¤è¯/æƒé™ç®¡ç†   | JWT + Redis + Aliyun SDK        |
| user_service       | ç”¨æˆ·æ•°æ®æœåŠ¡ (gRPC) | gRPC + Async ORM                |
| seckill_api        | ç§’æ€ä¸šåŠ¡å¤„ç†        | Redisç¼“å­˜ + å¼‚æ­¥é˜Ÿåˆ— + åˆ†å¸ƒå¼é” |
| admin_back         | ç®¡ç†åå°æœåŠ¡        | Django Admin + RBAC             |
| kafka_consumer     | è®¢å•ä¸‹å•            | kafka + åˆ†å¸ƒå¼é”                |
| kafka_compensation | è®¢å•å¼‚å¸¸å¤„ç†        | kafka + 2PC + åˆ†å¸ƒå¼é”          |

### åŸºç¡€è®¾æ–½
- **æ¶ˆæ¯é˜Ÿåˆ—**: Kafkaï¼ˆè®¢å•/åº“å­˜ä¸»é¢˜ï¼‰
- **ç›‘æ§ç³»ç»Ÿ**: PrometheusæŒ‡æ ‡é‡‡é›† + Grafanaå¯è§†åŒ–
- **æœåŠ¡å‘ç°**: Consulé›†ç¾¤ç®¡ç†

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### å‰ç½®è¦æ±‚
- Python 3.12+
- MySQL 8.0 & Redis 6.x
- Kafka 3.x é›†ç¾¤
- Consul 1.15+

### æœ¬åœ°å¼€å‘ç¯å¢ƒ
1. **å¯åŠ¨åŸºç¡€è®¾æ–½**
```bash
# Consul
consul agent -dev

# Kafka (KRaftæ¨¡å¼)
export KAFKA_CLUSTER_ID=$(bin/kafka-storage.sh random-uuid)
bin/kafka-storage.sh format -t $KAFKA_CLUSTER_ID -c config/kraft/server.properties
bin/kafka-server-start.sh config/kraft/server.properties
```

2. **æœåŠ¡å¯åŠ¨é¡ºåº**

```bash
# ç”¨æˆ·æœåŠ¡
python -m user_service.main

# APIæœåŠ¡ï¼ˆä¸åŒç»ˆç«¯ï¼‰
uvicorn user_api.main:app --host 0.0.0.0 --port 8000
uvicorn seckill_api.main:app --host 0.0.0.0 --port 8100 --reload

# ç®¡ç†åå°
python manage.py runserver 0.0.0.0:9000

# Kafkaæ¶ˆè´¹è€… è®¢å•ä¸‹å•å¤„ç†
python seckill_api/kafka_consumer.py

# Kafkaæ¶ˆè´¹è€… è®¢å•å¼‚å¸¸å¤„ç†
python seckill_api/kafka_compensation.py 
```

## ğŸ“ˆ ç›‘æ§ä¸è¿ç»´

- **æœåŠ¡å‘ç°**: è®¿é—® `http://localhost:8500` æŸ¥çœ‹Consulé¢æ¿
- **æŒ‡æ ‡ç›‘æ§**:
  - Prometheus: `http://localhost:9090`
  - Grafana: `http://localhost:3000` (é»˜è®¤è´¦å·admin/admin)
- **æ—¥å¿—ç³»ç»Ÿ**: é›†æˆLoguruå®ç°ç»“æ„åŒ–æ—¥å¿—ï¼ˆè·¯å¾„ï¼š/logs/*.logï¼‰

## ğŸ”§ ç¯å¢ƒé…ç½®

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹å‚æ•°ï¼š

```bash
cp config.example.yaml config.yaml
```

å…³é”®é…ç½®é¡¹ï¼š

```bash
database:
  mysql:
    host: 127.0.0.1
    port: 3306
    user: seckill_user
    password: your_password
    
redis:
  cache_db:
    host: localhost
    port: 6379
    db: 0

aliyun:
  oss:
    endpoint: oss-cn-hangzhou.aliyuncs.com
    access_key: your_key
    
compensation:
  max_retries: 3       # æœ€å¤§é‡è¯•æ¬¡æ•°
  retry_delay: [10, 30, 60]  # åˆ†çº§é‡è¯•é—´éš”
  dlq_topic: "compensation_dlq"  # æ­»ä¿¡é˜Ÿåˆ—ä¸»é¢˜
  log_storage: "both"  # æ—¥å¿—å­˜å‚¨æ–¹å¼ï¼ˆdb/file/bothï¼‰
    
dlq:
  max_retries: 2               # DLQæœ€å¤§é‡è¯•æ¬¡æ•°
  alert_webhook: "https://oapi.dingtalk.com/robot/send?access_token=xxx"
  archive_storage: "postgres"  # å½’æ¡£å­˜å‚¨ç±»å‹ï¼ˆpostgres/s3ï¼‰
  
transaction:
  timeout: 300     # äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  retry_policy: 
    max_attempts: 3
    backoff_factor: 1.5
  lock_prefix: "global_tx_lock"  # åˆ†å¸ƒå¼é”å‰ç¼€
```

## ğŸš© æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹

### é«˜å¹¶å‘ç§’æ€æ ¸å¿ƒè®¾è®¡
![åº“å­˜æ‰£å‡æµç¨‹](docs/assets/seckill-flow.png) <!-- æ–°å¢æµç¨‹å›¾ -->

| æŠ€æœ¯ç‚¹           | å®ç°æ–¹æ¡ˆ                                           | è§£å†³ç—›ç‚¹       |
| ---------------- | -------------------------------------------------- | -------------- |
| **é¢„æ‰£åº“å­˜æœºåˆ¶** | Redis Hashç»“æ„å­˜å‚¨å•†å“åº“å­˜ + Luaè„šæœ¬åŸå­æ“ä½œ       | é¿å…è¶…å–é—®é¢˜   |
| **åˆ†å¸ƒå¼é”**     | Redlockç®—æ³• + Redis SETNXæŒ‡ä»¤ï¼ˆè‡ªåŠ¨ç»­æœŸ/è¶…æ—¶é‡Šæ”¾ï¼‰ | é˜²æ­¢é‡å¤ä¸‹å•   |
| **åº“å­˜å›æ»šè¡¥å¿** | Kafkaæ¶ˆæ¯æŒä¹…åŒ– + å®šæ—¶ä»»åŠ¡æ‰«æå¼‚å¸¸è®¢å•             | ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ |
| **çƒ­ç‚¹æ•°æ®éš”ç¦»** | ç‹¬ç«‹Redisé›†ç¾¤éƒ¨ç½²ç§’æ€åº“å­˜ + æœ¬åœ°ç¼“å­˜äºŒçº§ç¼“å­˜       | é™ä½æ•°æ®åº“å‹åŠ› |

## ğŸ§© æœåŠ¡æ¨¡å—ï¼ˆæ–°å¢å…³é”®å®ç°ï¼‰

### seckill_api æ ¸å¿ƒé€»è¾‘
```python
# ç¤ºä¾‹ä»£ç ç‰‡æ®µï¼ˆä¼ªä»£ç ï¼‰
async def seckill_handler(product_id: str, user_id: str):
    # 1. è·å–åˆ†å¸ƒå¼é”
    lock = await redis.lock(f"seckill:{product_id}", timeout=10s)
    
    try:
        # 2. é¢„æ‰£åº“å­˜ï¼ˆLuaè„šæœ¬ä¿è¯åŸå­æ€§ï¼‰
        stock_key = f"product:{product_id}:stock"
        remain = await redis.eval(PREDUCE_STOCK_LUA, [stock_key], [1])
        
        if remain < 0:
            raise SoldOutException()
            
        # 3. åˆ›å»ºè®¢å•äº‹ä»¶
        await kafka.send("order_events", {
            "user_id": user_id,
            "product_id": product_id,
            "status": "pending"
        })
        
    finally:
        await lock.release()
```

## ğŸ›¡ï¸ å®¹é”™æœºåˆ¶è®¾è®¡

### è¡¥å¿ç³»ç»Ÿç‰¹æ€§
| åŠŸèƒ½         | å®ç°æ–¹å¼                                 | ä¼˜åŠ¿                         |
| ------------ | ---------------------------------------- | ---------------------------- |
| **æ—¥å¿—è¿½è¸ª** | åŒå†™æ—¥å¿—ï¼ˆæ•°æ®åº“+æ–‡ä»¶ï¼‰ + ç»“æ„åŒ–æ—¥å¿—æ ¼å¼ | ç¡®ä¿æ“ä½œå¯å®¡è®¡ï¼Œé˜²æ­¢æ—¥å¿—ä¸¢å¤± |
| **æ™ºèƒ½é‡è¯•** | åˆ†çº§é€€é¿ç­–ç•¥ï¼ˆ10s/30s/60sï¼‰ + é‡è¯•è®¡æ•°å™¨ | å¹³è¡¡ç³»ç»Ÿè´Ÿè½½ï¼Œé¿å…é›ªå´©æ•ˆåº”   |
| **æ­»ä¿¡é˜Ÿåˆ—** | è‡ªåŠ¨è½¬å…¥Kafka DLQä¸»é¢˜ + ä¼ä¸šå¾®ä¿¡æŠ¥è­¦é€šçŸ¥ | å…œåº•äººå·¥å¹²é¢„ï¼Œä¿è¯æœ€ç»ˆå¤„ç†   |

### ç›‘æ§æŒ‡æ ‡ï¼ˆGrafanaï¼‰
1. **è¡¥å¿æˆåŠŸç‡**ï¼š`sum(compensation_success_total) / sum(compensation_attempt_total)`
2. **é‡è¯•åˆ†å¸ƒ**ï¼šæŒ‰æ¬¡æ•°ç»Ÿè®¡çš„é‡è¯•æ“ä½œç›´æ–¹å›¾
3. **DLQå †ç§¯é‡**ï¼šæ­»ä¿¡é˜Ÿåˆ—æœªå¤„ç†æ¶ˆæ¯æ•°å‘Šè­¦

### æ­»ä¿¡é˜Ÿåˆ—å¤„ç†æµç¨‹

```mermaid
graph LR
    A[DLQæ¶ˆè´¹è€…] --> B{é‡è¯•æ¬¡æ•°æ£€æŸ¥}
    B -->|æœªè¶…é™| C[å°è¯•è¡¥å¿å¤„ç†]
    B -->|è¶…é™| D[å½’æ¡£å­˜å‚¨]
    C --> E{æˆåŠŸ?}
    E -->|æ˜¯| F[æ¸…é™¤é‡è¯•è®°å½•]
    E -->|å¦| G[è®°å½•é‡è¯•æ¬¡æ•°+æŠ¥è­¦]
    D --> H[å‘é€ç´§æ€¥å‘Šè­¦]
```

#### ç›‘æ§å¢å¼ºé¡¹

| ç›‘æ§æŒ‡æ ‡   | GrafanaæŸ¥è¯¢è¯­å¥                                              | å‘Šè­¦é˜ˆå€¼        |
| :--------- | :----------------------------------------------------------- | :-------------- |
| DLQå †ç§¯é‡  | `kafka_topic_partition_current_offset{topic="compensation_dlq"}` | >10 (æŒç»­5åˆ†é’Ÿ) |
| å½’æ¡£è®¢å•æ•° | `sum(failed_order_archived_total)`                           | >0 (ç«‹å³å‘Šè­¦)   |
| æœ€ç»ˆå¤±è´¥ç‡ | `failed_order_archived_total / compensation_attempt_total`   | >0.1%           |

#### æ–¹æ¡ˆä¼˜åŠ¿è¯´æ˜

1. **åŒé‡æ—¥å¿—ä¿éšœ**ï¼šæ•°æ®åº“æ—¥å¿—ç”¨äºä¸šåŠ¡æŸ¥è¯¢ï¼Œæ–‡ä»¶æ—¥å¿—ç”¨äºåº”æ€¥æ¢å¤
2. **è‡ªé€‚åº”é‡è¯•**ï¼šåŠ¨æ€è°ƒæ•´é‡è¯•é—´éš”ï¼Œé¿å…é›†ç¾¤é›ªå´©
3. **æ— ç¼é›†æˆ**ï¼šä¸ç°æœ‰Kafkaç›‘æ§ä½“ç³»å¯¹æ¥ï¼ŒDLQæ¶ˆæ¯å¯ç›´æ¥ç”¨äºæŠ¥è­¦
4. **åˆ†çº§å¤„ç†æœºåˆ¶**ï¼š
   - **è‡ªåŠ¨é‡è¯•**ï¼šDLQæ¶ˆæ¯å…ˆå°è¯•è‡ªåŠ¨æ¢å¤
   - **äººå·¥å…œåº•**ï¼šè¶…è¿‡é‡è¯•æ¬¡æ•°åå½’æ¡£å¹¶æŠ¥è­¦
   - **å®¡è®¡è¿½è¸ª**ï¼šæ‰€æœ‰æ“ä½œè®°å½•åœ¨`failed_order_archives`è¡¨
5. **ä¼ä¸šçº§ç›‘æ§**ï¼š
   - å®æ—¶ç›‘æ§DLQå †ç§¯é‡
   - é›†æˆé’‰é’‰/ä¼ä¸šå¾®ä¿¡å‘Šè­¦
   - Grafanaå±•ç¤ºæœ€ç»ˆå¤±è´¥ç‡è¶‹åŠ¿
6. **è¿ç»´å‹å¥½è®¾è®¡**ï¼š
   - æä¾›æ‰‹åŠ¨é‡è¯•APIæ¥å£
   - å½’æ¡£è®¢å•å¯æ‰¹é‡å¯¼å‡ºCSV
   - æ‰€æœ‰æ“ä½œè®°å½•å®¡è®¡æ—¥å¿—
7. **å¼¹æ€§é…ç½®**ï¼š
   - é‡è¯•æ¬¡æ•°/é—´éš”å¯åŠ¨æ€è°ƒæ•´
   - æ”¯æŒå¤šç§å½’æ¡£å­˜å‚¨åç«¯
   - æŠ¥è­¦æ¸ é“å¯æ’æ‹”æ›¿æ¢

åç»­æ‰©å±•ï¼š

1. å®ç°è‡ªåŠ¨å‘¨æŠ¥ç”Ÿæˆï¼ˆç»Ÿè®¡æ¯å‘¨è¡¥å¿æˆåŠŸç‡ï¼‰
2. æ·»åŠ æ··æ²Œå·¥ç¨‹æµ‹è¯•ç”¨ä¾‹ï¼ˆæ¨¡æ‹ŸKafkaæ•…éšœåœºæ™¯ï¼‰
3. å¼€å‘ç®¡ç†ç•Œé¢å¯è§†åŒ–æ“ä½œå½’æ¡£è®¢å•

### åˆ†å¸ƒå¼äº‹åŠ¡æ¢å¤æµç¨‹

```mermaid
graph TD
    A[äº‹åŠ¡å¼€å§‹] --> B{å‡†å¤‡é˜¶æ®µ}
    B -->|Redis+DBé¢„æäº¤æˆåŠŸ| C[æ ‡è®°ä¸ºPrepared]
    B -->|ä»»æ„å¤±è´¥| D[ç«‹å³å›æ»š]
    C --> E{æäº¤é˜¶æ®µ}
    E -->|å…¨éƒ¨æˆåŠŸ| F[æ ‡è®°ä¸ºCommitted]
    E -->|ä»»æ„å¤±è´¥| G[æ‰§è¡Œå…¨å±€å›æ»š]
    G --> H[è®°å½•äº‹åŠ¡æ—¥å¿—]
    
    style B fill:#f9f,stroke:#333
    style E fill:#ccf,stroke:#333
```

#### äº‹åŠ¡ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡åç§°     | è¯´æ˜                      | å‘Šè­¦é˜ˆå€¼           |
| :----------- | :------------------------ | :----------------- |
| äº‹åŠ¡æˆåŠŸç‡   | æˆåŠŸæäº¤äº‹åŠ¡å æ¯”          | <99.9% (æŒç»­1åˆ†é’Ÿ) |
| å¹³å‡æäº¤å»¶è¿Ÿ | ä»Preparedåˆ°Committedè€—æ—¶ | >500ms             |
| æ‚¬æŒ‚äº‹åŠ¡æ•°   | è¶…æ—¶æœªå®Œæˆçš„äº‹åŠ¡æ•°é‡      | >10                |

### åˆ†å¸ƒå¼äº‹åŠ¡ä¿éšœ

![ä¸¤é˜¶æ®µæäº¤æµç¨‹å›¾](docs/assets/2pc-flow.png) <!-- æ–°å¢äº‹åŠ¡æµç¨‹å›¾ -->

| æŠ€æœ¯ç‚¹                | å®ç°æ–¹æ¡ˆ                                    | ä¼˜åŠ¿è¯´æ˜               |
| --------------------- | ------------------------------------------- | ---------------------- |
| **ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰** | äº‹åŠ¡åè°ƒå™¨ + Redisé¢„å†™æ—¥å¿— + æ•°æ®åº“çŠ¶æ€è¿½è¸ª | ä¿è¯è·¨èµ„æºæ“ä½œçš„åŸå­æ€§ |
| **æ‚¬æŒ‚äº‹åŠ¡å¤„ç†**      | è‡ªåŠ¨è¶…æ—¶å›æ»šï¼ˆ300ç§’ï¼‰ + å®šæ—¶æ‰«ææ¸…ç†        | é¿å…èµ„æºé•¿æœŸé”å®š       |
| **äº‹åŠ¡å¯è§‚æµ‹æ€§**      | Prometheusäº‹åŠ¡æŒ‡æ ‡é‡‡é›† + è¡¥å¿æ—¥å¿—å¯è§†åŒ–     | å®æ—¶ç›‘æ§äº‹åŠ¡å¥åº·åº¦     |

#### transaction_coordinator äº‹åŠ¡åè°ƒå™¨

| æ–¹æ³•                 | åŠŸèƒ½è¯´æ˜                 | å…³é”®æŠ€æœ¯                 |
| -------------------- | ------------------------ | ------------------------ |
| begin_transaction    | å¯åŠ¨äº‹åŠ¡å¹¶è®°å½•é¢„æäº¤çŠ¶æ€ | Redisäº‹åŠ¡æ—¥å¿— + è¿‡æœŸæ—¶é—´ |
| commit_transaction   | æ ‡è®°äº‹åŠ¡æœ€ç»ˆæäº¤         | åŸå­çŠ¶æ€æ›´æ–°             |
| rollback_transaction | æ‰§è¡Œå…¨å±€å›æ»šæ“ä½œ         | é€†å‘æ“ä½œè¡¥å¿             |

#### æ–¹æ¡ˆä¼˜åŠ¿æ€»ç»“

1. **ä¸¥æ ¼çš„ACIDç‰¹æ€§**ï¼š
   - é€šè¿‡2PCåè®®ç¡®ä¿è·¨Redisä¸MySQLçš„æ“ä½œåŸå­æ€§
   - é‡‡ç”¨é¢„å†™æ—¥å¿—ï¼ˆWALï¼‰æœºåˆ¶é˜²æ­¢æ•°æ®ä¸¢å¤±

2. **ç”Ÿäº§çº§å¯é æ€§**ï¼š
   - äº‹åŠ¡çŠ¶æ€è‡ªåŠ¨è¿½è¸ªä¸è¶…æ—¶å›æ»š
   - å¼‚å¸¸åœºæ™¯ä¸‹çš„è‡ªåŠ¨è¡¥å¿é‡è¯•ï¼ˆæœ€å¤§3æ¬¡ï¼‰

3. **é«˜æ€§èƒ½è®¾è®¡**ï¼š
   - Redisäº‹åŠ¡æ“ä½œå¹³å‡è€—æ—¶ < 5ms
   - æ”¯æŒå¹¶è¡Œå¤„ç†500+å¹¶å‘äº‹åŠ¡

4. **å…¨é“¾è·¯å¯è§‚æµ‹**ï¼š
   - äº‹åŠ¡ç”Ÿå‘½å‘¨æœŸè¿½è¸ªï¼ˆåˆ›å»ºâ†’é¢„æäº¤â†’æäº¤/å›æ»šï¼‰
   - é›†æˆPrometheus+Grafanaç›‘æ§ä½“ç³»

5. **è¿ç»´å‹å¥½æ€§**ï¼š
   - æä¾›äº‹åŠ¡æŸ¥è¯¢/æ‰‹åŠ¨å›æ»šAPIæ¥å£
   - å…³é”®æŒ‡æ ‡å¼‚å¸¸è‡ªåŠ¨å‘Šè­¦ï¼ˆé‚®ä»¶/é’‰é’‰ï¼‰

---

**æ•ˆæœå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ              | ååé‡ï¼ˆTPSï¼‰ | å¹³å‡å»¶è¿Ÿ | æ•°æ®ä¸€è‡´æ€§ä¿éšœ |
| ----------------- | ------------- | -------- | -------------- |
| æœ¬åœ°äº‹åŠ¡          | 1500          | 20ms     | å•æœåŠ¡å¯é      |
| æ™®é€šæ¶ˆæ¯é˜Ÿåˆ—      | 800           | 50ms     | æœ€ç»ˆä¸€è‡´æ€§     |
| **æœ¬ç³»ç»Ÿ2PCæ–¹æ¡ˆ** | 1200          | 35ms     | å¼ºä¸€è‡´æ€§       |

### è¿ç»´æ“ä½œæŒ‡å—

#### æ‰‹åŠ¨é‡è¯•å½’æ¡£è®¢å•

```
# æŸ¥çœ‹è¡¥å¿æ—¥å¿—
psql -c "SELECT * FROM compensation_logs ORDER BY timestamp DESC LIMIT 10;"

# ç›‘æ§é‡è¯•æ¬¡æ•°
redis-cli KEYS "compensation_retries:*"

# å¤„ç†æ­»ä¿¡é˜Ÿåˆ—
kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic compensation_dlq

# æŸ¥è¯¢å½’æ¡£è®¢å•
psql -c "SELECT * FROM failed_order_archives WHERE handled = false;"

# è§¦å‘é‡è¯•ï¼ˆç¤ºä¾‹ï¼‰
curl -X POST http://admin_api/reprocess_order/{order_id}
```

#### æŠ¥è­¦é…ç½®ç¤ºä¾‹ï¼ˆPrometheus Alertmanagerï¼‰

```
- name: dlq_alert
  rules:
  - alert: DLQå †ç§¯å‘Šè­¦
    expr: kafka_topic_partition_current_offset{topic="compensation_dlq"} > 10
    for: 5m
    annotations:
      summary: "æ­»ä¿¡é˜Ÿåˆ—å †ç§¯å‘Šè­¦"
      description: "DLQå½“å‰å †ç§¯é‡ {{ $value }} æ¡"
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿é€šè¿‡Issueå’ŒPRå‚ä¸è´¡çŒ®ï¼š

1. Forké¡¹ç›®ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤ä¿®æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

[MIT License](https://license/)

## ğŸ“„ åç»­ä¼˜åŒ–

1. è¡¥å……æ€§èƒ½å‹æµ‹æŠ¥å‘Š
2. å¢åŠ Dockeréƒ¨ç½²æ–¹æ¡ˆ
3. è¡¥å……APIæ–‡æ¡£é“¾æ¥ï¼ˆå¦‚Swaggerï¼‰
4. æ·»åŠ ç³»ç»ŸQPSç­‰å…³é”®æŒ‡æ ‡æ•°æ®
5. å¢åŠ æ¶æ„è®¾è®¡åŸç†è¯´æ˜